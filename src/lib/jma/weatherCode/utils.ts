import type { JmaWeatherIcon } from "./types";

const JMA_FORECAST_IMAGE_BASE_URL = "https://www.jma.go.jp/bosai/forecast/img";

export const jmaWeatherCodeMap = {
  "100": "晴",
  "101": "晴時々曇",
  "102": "晴一時雨",
  "103": "晴時々雨",
  "104": "晴一時雪",
  "105": "晴時々雪",
  "106": "晴一時雨か雪",
  "107": "晴時々雨か雪",
  "108": "晴一時雨か雷雨",
  "110": "晴後時々曇",
  "111": "晴後曇",
  "112": "晴後一時雨",
  "113": "晴後時々雨",
  "114": "晴後雨",
  "115": "晴後一時雪",
  "116": "晴後時々雪",
  "117": "晴後雪",
  "118": "晴後雨か雪",
  "119": "晴後雨か雷雨",
  "120": "晴朝夕一時雨",
  "121": "晴朝の内一時雨",
  "122": "晴夕方一時雨",
  "123": "晴山沿い雷雨",
  "124": "晴山沿い雪",
  "125": "晴午後は雷雨",
  "126": "晴昼頃から雨",
  "127": "晴夕方から雨",
  "128": "晴夜は雨",
  "130": "朝の内霧後晴",
  "131": "晴明け方霧",
  "132": "晴朝夕曇",
  "140": "晴時々雨で雷を伴う",
  "160": "晴一時雪か雨",
  "170": "晴時々雪か雨",
  "181": "晴後雪か雨",
  "200": "曇",
  "201": "曇時々晴",
  "202": "曇一時雨",
  "203": "曇時々雨",
  "204": "曇一時雪",
  "205": "曇時々雪",
  "206": "曇一時雨か雪",
  "207": "曇時々雨か雪",
  "208": "曇一時雨か雷雨",
  "209": "霧",
  "210": "曇後時々晴",
  "211": "曇後晴",
  "212": "曇後一時雨",
  "213": "曇後時々雨",
  "214": "曇後雨",
  "215": "曇後一時雪",
  "216": "曇後時々雪",
  "217": "曇後雪",
  "218": "曇後雨か雪",
  "219": "曇後雨か雷雨",
  "220": "曇朝夕一時雨",
  "221": "曇朝の内一時雨",
  "222": "曇夕方一時雨",
  "223": "曇日中時々晴",
  "224": "曇昼頃から雨",
  "225": "曇夕方から雨",
  "226": "曇夜は雨",
  "228": "曇昼頃から雪",
  "229": "曇夕方から雪",
  "230": "曇夜は雪",
  "231": "曇海上海岸は霧か霧雨",
  "240": "曇時々雨で雷を伴う",
  "250": "曇時々雪で雷を伴う",
  "260": "曇一時雪か雨",
  "270": "曇時々雪か雨",
  "281": "曇後雪か雨",
  "300": "雨",
  "301": "雨時々晴",
  "302": "雨時々止む",
  "303": "雨時々雪",
  "304": "雨か雪",
  "306": "大雨",
  "308": "雨で暴風を伴う",
  "309": "雨一時雪",
  "311": "雨後晴",
  "313": "雨後曇",
  "314": "雨後時々雪",
  "315": "雨後雪",
  "316": "雨か雪後晴",
  "317": "雨か雪後曇",
  "320": "朝の内雨後晴",
  "321": "朝の内雨後曇",
  "322": "雨朝晩一時雪",
  "323": "雨昼頃から晴",
  "324": "雨夕方から晴",
  "325": "雨夜は晴",
  "326": "雨夕方から雪",
  "327": "雨夜は雪",
  "328": "雨一時強く降る",
  "329": "雨一時みぞれ",
  "340": "雪か雨",
  "350": "雨で雷を伴う",
  "361": "雪か雨後晴",
  "371": "雪か雨後曇",
  "400": "雪",
  "401": "雪時々晴",
  "402": "雪時々止む",
  "403": "雪時々雨",
  "405": "大雪",
  "406": "風雪強い",
  "407": "暴風雪",
  "409": "雪一時雨",
  "411": "雪後晴",
  "413": "雪後曇",
  "414": "雪後雨",
  "420": "朝の内雪後晴",
  "421": "朝の内雪後曇",
  "422": "雪昼頃から雨",
  "423": "雪夕方から雨",
  "425": "雪一時強く降る",
  "426": "雪後みぞれ",
  "427": "雪一時みぞれ",
  "450": "雪で雷を伴う",
} as const;

export type JmaWeatherCode = keyof typeof jmaWeatherCodeMap;

/**
 * 気象庁の天気コードから対応する天気の文字列を取得
 * @param code 気象庁の天気コード
 * @param fallback 不明なコードの場合のデフォルト値（省略時は "不明"）
 * @returns 天気を表す文字列
 */
/**
 * 気象庁の天気コードに対応するSVGアイコンの情報
 */
export const jmaWeatherIcons: Record<
  keyof typeof jmaWeatherCodeMap,
  [string, string]
> = {
  "100": ["100.svg", "500.svg"],
  "101": ["101.svg", "501.svg"],
  "102": ["102.svg", "502.svg"],
  "103": ["102.svg", "502.svg"],
  "104": ["104.svg", "504.svg"],
  "105": ["104.svg", "504.svg"],
  "106": ["102.svg", "502.svg"],
  "107": ["102.svg", "502.svg"],
  "108": ["102.svg", "502.svg"],
  "110": ["110.svg", "510.svg"],
  "111": ["110.svg", "510.svg"],
  "112": ["112.svg", "512.svg"],
  "113": ["112.svg", "512.svg"],
  "114": ["112.svg", "512.svg"],
  "115": ["115.svg", "515.svg"],
  "116": ["115.svg", "515.svg"],
  "117": ["115.svg", "515.svg"],
  "118": ["112.svg", "512.svg"],
  "119": ["112.svg", "512.svg"],
  "120": ["102.svg", "502.svg"],
  "121": ["102.svg", "502.svg"],
  "122": ["112.svg", "512.svg"],
  "123": ["100.svg", "500.svg"],
  "124": ["100.svg", "500.svg"],
  "125": ["112.svg", "512.svg"],
  "126": ["112.svg", "512.svg"],
  "127": ["112.svg", "512.svg"],
  "128": ["112.svg", "512.svg"],
  "130": ["100.svg", "500.svg"],
  "131": ["100.svg", "500.svg"],
  "132": ["101.svg", "501.svg"],
  "140": ["102.svg", "502.svg"],
  "160": ["104.svg", "504.svg"],
  "170": ["104.svg", "504.svg"],
  "181": ["115.svg", "515.svg"],
  "200": ["200.svg", "200.svg"],
  "201": ["201.svg", "601.svg"],
  "202": ["202.svg", "202.svg"],
  "203": ["202.svg", "202.svg"],
  "204": ["204.svg", "204.svg"],
  "205": ["204.svg", "204.svg"],
  "206": ["202.svg", "202.svg"],
  "207": ["202.svg", "202.svg"],
  "208": ["202.svg", "202.svg"],
  "209": ["200.svg", "200.svg"],
  "210": ["210.svg", "610.svg"],
  "211": ["210.svg", "610.svg"],
  "212": ["212.svg", "212.svg"],
  "213": ["212.svg", "212.svg"],
  "214": ["212.svg", "212.svg"],
  "215": ["215.svg", "215.svg"],
  "216": ["215.svg", "215.svg"],
  "217": ["215.svg", "215.svg"],
  "218": ["212.svg", "212.svg"],
  "219": ["212.svg", "212.svg"],
  "220": ["202.svg", "202.svg"],
  "221": ["202.svg", "202.svg"],
  "222": ["212.svg", "212.svg"],
  "223": ["201.svg", "601.svg"],
  "224": ["212.svg", "212.svg"],
  "225": ["212.svg", "212.svg"],
  "226": ["212.svg", "212.svg"],
  "228": ["215.svg", "215.svg"],
  "229": ["215.svg", "215.svg"],
  "230": ["215.svg", "215.svg"],
  "231": ["200.svg", "200.svg"],
  "240": ["202.svg", "202.svg"],
  "250": ["204.svg", "204.svg"],
  "260": ["204.svg", "204.svg"],
  "270": ["204.svg", "204.svg"],
  "281": ["215.svg", "215.svg"],
  "300": ["300.svg", "300.svg"],
  "301": ["301.svg", "701.svg"],
  "302": ["302.svg", "302.svg"],
  "303": ["303.svg", "303.svg"],
  "304": ["300.svg", "300.svg"],
  "306": ["300.svg", "300.svg"],
  "308": ["308.svg", "308.svg"],
  "309": ["303.svg", "303.svg"],
  "311": ["311.svg", "711.svg"],
  "313": ["313.svg", "313.svg"],
  "314": ["314.svg", "314.svg"],
  "315": ["314.svg", "314.svg"],
  "316": ["311.svg", "711.svg"],
  "317": ["313.svg", "313.svg"],
  "320": ["311.svg", "711.svg"],
  "321": ["313.svg", "313.svg"],
  "322": ["303.svg", "303.svg"],
  "323": ["311.svg", "711.svg"],
  "324": ["311.svg", "711.svg"],
  "325": ["311.svg", "711.svg"],
  "326": ["314.svg", "314.svg"],
  "327": ["314.svg", "314.svg"],
  "328": ["300.svg", "300.svg"],
  "329": ["300.svg", "300.svg"],
  "340": ["400.svg", "400.svg"],
  "350": ["300.svg", "300.svg"],
  "361": ["411.svg", "811.svg"],
  "371": ["413.svg", "413.svg"],
  "400": ["400.svg", "400.svg"],
  "401": ["401.svg", "801.svg"],
  "402": ["402.svg", "402.svg"],
  "403": ["403.svg", "403.svg"],
  "405": ["400.svg", "400.svg"],
  "406": ["406.svg", "406.svg"],
  "407": ["406.svg", "406.svg"],
  "409": ["403.svg", "403.svg"],
  "411": ["411.svg", "811.svg"],
  "413": ["413.svg", "413.svg"],
  "414": ["414.svg", "414.svg"],
  "420": ["411.svg", "811.svg"],
  "421": ["413.svg", "413.svg"],
  "422": ["414.svg", "414.svg"],
  "423": ["414.svg", "414.svg"],
  "425": ["400.svg", "400.svg"],
  "426": ["400.svg", "400.svg"],
  "427": ["400.svg", "400.svg"],
  "450": ["400.svg", "400.svg"],
};

export const getWeatherText = (
  code: JmaWeatherCode,
  fallback: string = "不明"
): string => {
  // codeがjmaWeatherCodeMapのキーとして存在するか型安全にチェック
  if (code in jmaWeatherCodeMap) {
    return jmaWeatherCodeMap[code as JmaWeatherCode];
  }

  // 開発時のデバッグ用にコンソールに警告を出力
  if (process.env.NODE_ENV === "development") {
    console.warn(`未定義の天気コードです: ${code}`);
  }

  return fallback;
};

/**
 * 気象庁の天気予報SVGアイコンのURLを取得する
 * @param code 天気コード
 * @returns 昼用と夜用のアイコンURL
 */
export const getJmaWeatherIcon = (
  code: JmaWeatherCode
): JmaWeatherIcon | undefined => {
  const icons = jmaWeatherIcons[code];
  if (!icons) return undefined;

  const [dayIcon, nightIcon] = icons;
  return {
    dayIcon: `${JMA_FORECAST_IMAGE_BASE_URL}/${dayIcon}`,
    nightIcon: `${JMA_FORECAST_IMAGE_BASE_URL}/${nightIcon}`,
  };
};
